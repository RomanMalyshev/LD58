# Architecture - Procedural Map Generator

## ๐๏ธ ะััะธัะตะบัััะฝัะน ะพะฑะทะพั

ะกะธััะตะผะฐ ะฟะพัััะพะตะฝะฐ ะฟะพ ะผะพะดัะปัะฝะพะผั ะฟัะธะฝัะธะฟั ั ัะตัะบะธะผ ัะฐะทะดะตะปะตะฝะธะตะผ ะพัะฒะตัััะฒะตะฝะฝะพััะธ.

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    Unity Editor / Runtime                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ              MapGeneratorController (Entry Point)            โ
โ  โข ะฃะฟัะฐะฒะปัะตั ะฟัะพัะตััะพะผ ะณะตะฝะตัะฐัะธะธ                            โ
โ  โข ะะตะณะธัััะธััะตั ะฟัะตัะฐะฑั                                      โ
โ  โข ะัะตะดะพััะฐะฒะปัะตั ะฟัะฑะปะธัะฝัะน API                               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                โ                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ ProceduralMapGenerator    โ   โ    MapBuilder               โ
โ โข ะะตะฝะตัะธััะตั ะดะฐะฝะฝัะต       โ   โ โข ะกััะพะธั ัะธะทะธัะตัะบัั ะบะฐััั   โ
โ โข ะกะพะทะดะฐะตั ัะตัะบั           โโ  โ โข ะะฝััะฐะฝัะธััะตั ะฟัะตัะฐะฑั      โ
โ โข ะะฐะทะผะตัะฐะตั ัะฐะนะปั         โ   โ โข ะกะพััะฐะฝัะตั ะฒ MapSettings   โ
โ โข ะะฑะตัะฟะตัะธะฒะฐะตั ะฑะฐะปะฐะฝั     โ   โ                             โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                โ                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ MapGenerationConfig       โ   โ    MapAnalyzer              โ
โ โข ะะฐัะฐะผะตััั ะณะตะฝะตัะฐัะธะธ     โ   โ โข ะะฝะฐะปะธะทะธััะตั ะฑะฐะปะฐะฝั        โ
โ โข ะัะพัะตะฝัะฝะพะต ัะฐัะฟัะตะด.     โ   โ โข ะััะธัะปัะตั ะผะตััะธะบะธ         โ
โ โข ะัะฐะฒะธะปะฐ ะธ ะพะณัะฐะฝะธัะตะฝะธั   โ   โ โข ะะฐะตั ัะตะบะพะผะตะฝะดะฐัะธะธ         โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

## ๐ฆ ะะพะผะฟะพะฝะตะฝัั ะธ ะพัะฒะตัััะฒะตะฝะฝะพััั

### 1. Configuration Layer (ะกะปะพะน ะบะพะฝัะธะณััะฐัะธะธ)

#### MapGenerationConfig (ScriptableObject)
**ะัะฒะตัััะฒะตะฝะฝะพััั:** ะฅัะฐะฝะตะฝะธะต ะฟะฐัะฐะผะตััะพะฒ ะณะตะฝะตัะฐัะธะธ

**ะะฐะฝะฝัะต:**
- ะะฐะทะผะตั ะบะฐััั (ัะฐะดะธัั)
- ะัะพัะตะฝัะฝะพะต ัะฐัะฟัะตะดะตะปะตะฝะธะต ัะธะฟะพะฒ ัะฐะนะปะพะฒ
- ะะพะปะธัะตััะฒะพ ัะฟะตัะธะฐะปัะฝัั ะพะฑัะตะบัะพะฒ
- ะัะฐะฒะธะปะฐ ะณะตะฝะตัะฐัะธะธ (ัะฒัะทะฝะพััั, ะบะปะฐััะตัะธะทะฐัะธั)
- ะะฐัััะพะนะบะธ ะฑะฐะปะฐะฝัะฐ (centralization, danger progression)

**ะะตัะพะดั:**
- `GetRandomTileType()` - ะัะฑะพั ัะธะฟะฐ ัะฐะนะปะฐ ะฟะพ ะฒะตัะพััะฝะพัััะผ
- `OnValidate()` - ะะฐะปะธะดะฐัะธั ะฟะฐัะฐะผะตััะพะฒ

**ะะธะทะฝะตะฝะฝัะน ัะธะบะป:** Asset, ัะพะทะดะฐะตััั ะฒ ัะตะดะฐะบัะพัะต, ะฟะตัะตะธัะฟะพะปัะทัะตััั

---

### 2. Generation Layer (ะกะปะพะน ะณะตะฝะตัะฐัะธะธ)

#### ProceduralMapGenerator (Class)
**ะัะฒะตัััะฒะตะฝะฝะพััั:** ะกะพะทะดะฐะฝะธะต ะดะฐะฝะฝัั ะบะฐััั

**ะัะพัะตัั ะณะตะฝะตัะฐัะธะธ:**
```
1. ะะฝะธัะธะฐะปะธะทะฐัะธั Random ั seed
2. ะะตะฝะตัะฐัะธั ะณะตะบัะฐะณะพะฝะฐะปัะฝะพะน ัะตัะบะธ (cube coordinates)
3. ะะฐะทะผะตัะตะฝะธะต ะทะฐะผะบะฐ ะธะณัะพะบะฐ (ัะตะฝัั)
4. ะะฐะทะผะตัะตะฝะธะต ะฒัะฐะถะตัะบะธั ะทะฐะผะบะพะฒ (ั ะดะธััะฐะฝัะธะตะน)
5. ะะฐะทะผะตัะตะฝะธะต ัะฟะตัะธะฐะปัะฝัั ัะฐะนะปะพะฒ (chest, tavern, camp)
6. ะะตะฝะตัะฐัะธั ะปะฐะฝะดัะฐััะฐ ะธ ัะตััััะพะฒ
7. ะะฑะตัะฟะตัะตะฝะธะต ัะฒัะทะฝะพััะธ (pathfinding)
8. ะะพัั-ะพะฑัะฐะฑะพัะบะฐ (ะบะปะฐััะตัะธะทะฐัะธั)
```

**ะะปะณะพัะธัะผั:**
- **Grid Generation:** Cube coordinate iteration
- **Placement:** Distance-based filtering + random selection
- **Terrain:** Weighted random with distance modifiers
- **Connectivity:** BFS ั ัะพะทะดะฐะฝะธะตะผ ะฟััะตะน
- **Clustering:** Neighbor propagation (30% chance)

**ะัะพะด:**
- MapGenerationConfig
- MapSettings

**ะััะพะด:**
- `Dictionary<Vector3Int, TileType>` - ะะฐััะฐ ะฟะพะทะธัะธะน โ ัะธะฟะพะฒ

**ะะธะทะฝะตะฝะฝัะน ัะธะบะป:** ะกะพะทะดะฐะตััั ะดะปั ะบะฐะถะดะพะน ะณะตะฝะตัะฐัะธะธ

---

### 3. Building Layer (ะกะปะพะน ะฟะพัััะพะตะฝะธั)

#### MapBuilder (Class)
**ะัะฒะตัััะฒะตะฝะฝะพััั:** ะะพัััะพะตะฝะธะต ัะธะทะธัะตัะบะพะน ะบะฐััั ะธะท ะดะฐะฝะฝัั

**ะัะพัะตัั:**
```
1. ะะตะณะธัััะฐัะธั ะฟัะตัะฐะฑะพะฒ ะดะปั ะบะฐะถะดะพะณะพ ัะธะฟะฐ
2. ะัะธััะบะฐ ัััะตััะฒัััะธั ัะฐะนะปะพะฒ
3. ะะปั ะบะฐะถะดะพะณะพ ัะฐะนะปะฐ:
   - ะะพะฝะฒะตััะฐัะธั ะฟะพะทะธัะธะธ ะฒ world space
   - ะะฝััะฐะฝัะธัะพะฒะฐะฝะธะต ะฟัะตัะฐะฑะฐ
   - ะะฐัััะพะนะบะฐ ะบะพะผะฟะพะฝะตะฝัะฐ Tile
4. (ะะฟัะธะพะฝะฐะปัะฝะพ) ะกะพััะฐะฝะตะฝะธะต ะฒ MapSettings
```

**ะะตัะพะดั:**
- `RegisterTilePrefab()` - ะะตะณะธัััะฐัะธั ะฟัะตัะฐะฑะฐ
- `BuildMap()` - ะะพัััะพะตะฝะธะต ะบะฐััั
- `SaveToMapSettings()` - ะกะพััะฐะฝะตะฝะธะต ะดะฐะฝะฝัั
- `ClearExistingTiles()` - ะัะธััะบะฐ

**ะัะพะด:**
- `Dictionary<Vector3Int, TileType>` ะธะท Generator
- ะัะตัะฐะฑั ัะฐะนะปะพะฒ
- MapSettings
- Parent Transform

**ะััะพะด:**
- ะคะธะทะธัะตัะบะฐั ะบะฐััะฐ ะฒ ััะตะฝะต
- (ะะฟัะธะพะฝะฐะปัะฝะพ) ะะฑะฝะพะฒะปะตะฝะฝัะน MapSettings asset

**ะะธะทะฝะตะฝะฝัะน ัะธะบะป:** ะกะพะทะดะฐะตััั ะดะปั ะบะฐะถะดะพะน ะณะตะฝะตัะฐัะธะธ

---

### 4. Controller Layer (ะกะปะพะน ัะฟัะฐะฒะปะตะฝะธั)

#### MapGeneratorController (MonoBehaviour)
**ะัะฒะตัััะฒะตะฝะฝะพััั:** ะะพะพัะดะธะฝะฐัะธั ะฟัะพัะตััะฐ ะธ ะธะฝัะตะณัะฐัะธั ั Unity

**ะคัะฝะบัะธะธ:**
- ะฅัะฐะฝะตะฝะธะต ัััะปะพะบ ะฝะฐ ะฒัะต ะฝะตะพะฑัะพะดะธะผัะต ะบะพะผะฟะพะฝะตะฝัั
- ะะตะณะธัััะฐัะธั ะฟัะตัะฐะฑะพะฒ
- ะะฐะฟััะบ ะณะตะฝะตัะฐัะธะธ
- ะัะตะดะพััะฐะฒะปะตะฝะธะต ะฟัะฑะปะธัะฝะพะณะพ API
- ะะฝัะตะณัะฐัะธั ั Unity lifecycle

**ะัะฑะปะธัะฝัะต ะผะตัะพะดั:**
- `GenerateNewMap()` - ะัะฝะพะฒะฝะพะน ะผะตัะพะด ะณะตะฝะตัะฐัะธะธ
- `GenerateWithRandomSeed()` - ะะตะฝะตัะฐัะธั ั ัะปััะฐะนะฝัะผ seed
- `ShowMapStatistics()` - ะะพะบะฐะทะฐัั ััะฐัะธััะธะบั
- `ClearMap()` - ะัะธััะธัั ะบะฐััั

**ะะธะทะฝะตะฝะฝัะน ัะธะบะป:** MonoBehaviour, ะถะธะฒะตั ะฒ ััะตะฝะต

---

### 5. Analysis Layer (ะกะปะพะน ะฐะฝะฐะปะธะทะฐ)

#### MapAnalyzer (Static Utility)
**ะัะฒะตัััะฒะตะฝะฝะพััั:** ะะฝะฐะปะธะท ะธ ะฒะฐะปะธะดะฐัะธั ัะณะตะฝะตัะธัะพะฒะฐะฝะฝะพะน ะบะฐััั

**ะะตััะธะบะธ:**
- `ResourceDensity` - ะัะพัะตะฝั ัะตััััะฝัั ัะฐะนะปะพะฒ
- `CombatDensity` - ะัะพัะตะฝั ะฑะพะตะฒัั ัะฐะนะปะพะฒ
- `TileDistribution` - ะะฐัะฟัะตะดะตะปะตะฝะธะต ะฟะพ ัะธะฟะฐะผ
- `IsBalanced` - ะะฐะทะพะฒัะต ะฟัะพะฒะตัะบะธ ะบะพััะตะบัะฝะพััะธ

**ะัะพะฒะตัะบะธ:**
- ะะฐะปะธัะธะต ัะพะฒะฝะพ 1 ะทะฐะผะบะฐ ะธะณัะพะบะฐ
- ะะฐะปะธัะธะต ัะพัั ะฑั 1 ะฒัะฐะถะตัะบะพะณะพ ะทะฐะผะบะฐ
- ะะฐะปะฐะฝั ัะตััััะพะฒ (30-70%)
- ะะฐะทัะผะฝะพะต ะบะพะปะธัะตััะฒะพ ะฟัะตะฟััััะฒะธะน
- ะะฐะทะฝะพะพะฑัะฐะทะธะต ัะฐะนะปะพะฒ

**ะะตะบะพะผะตะฝะดะฐัะธะธ:**
- ะะตะดะพััะฐัะพะบ ะพะฟัะตะดะตะปะตะฝะฝัั ัะตััััะพะฒ
- ะกะปะธัะบะพะผ ะผะฝะพะณะพ/ะผะฐะปะพ ัะพะฑััะธะน
- ะัะพะฑะปะตะผั ั ะดะพัััะฟะฝะพัััั

**ะัะฟะพะปัะทะพะฒะฐะฝะธะต:**
```csharp
var analysis = MapAnalyzer.Analyze(generatedMap);
MapAnalyzer.PrintReport(analysis);
```

---

## ๐ ะะพัะพะบ ะดะฐะฝะฝัั

```
Config (Asset)
    โ
Generator.GenerateMap() โ Dictionary<Vector3Int, TileType>
    โ
Analyzer.Analyze() โ AnalysisResult
    โ
Builder.BuildMap() โ Physical Tiles in Scene
    โ
(Optional) Builder.SaveToMapSettings() โ MapSettings Asset
```

## ๐ฏ Design Patterns

### 1. **Builder Pattern**
`MapBuilder` ัััะพะธั ัะปะพะถะฝัะน ะพะฑัะตะบั (ะบะฐััั) ะฟะพัะฐะณะพะฒะพ

### 2. **Strategy Pattern**
ะะฐะทะฝัะต ะบะพะฝัะธะณััะฐัะธะธ = ัะฐะทะฝัะต ัััะฐัะตะณะธะธ ะณะตะฝะตัะฐัะธะธ

### 3. **Factory Pattern**
`TileCreate()` ะผะตัะพะดั ะฒ MapSettings

### 4. **Facade Pattern**
`MapGeneratorController` - ะฟัะพััะพะน ะธะฝัะตััะตะนั ะดะปั ัะปะพะถะฝะพะน ัะธััะตะผั

### 5. **Static Utility Pattern**
`MapAnalyzer` - ัะธัััะต ััะฝะบัะธะธ ะฑะตะท ัะพััะพัะฝะธั

## ๐ ะัะธะฝัะธะฟั SOLID

### Single Responsibility Principle โ
ะะฐะถะดัะน ะบะปะฐัั ะธะผะตะตั ะพะดะฝั ะพัะฒะตัััะฒะตะฝะฝะพััั:
- Config โ ะฅัะฐะฝะตะฝะธะต ะฟะฐัะฐะผะตััะพะฒ
- Generator โ ะะตะฝะตัะฐัะธั ะดะฐะฝะฝัั
- Builder โ ะะพัััะพะตะฝะธะต ัะธะทะธะบะธ
- Controller โ ะะพะพัะดะธะฝะฐัะธั
- Analyzer โ ะะฝะฐะปะธะท

### Open/Closed Principle โ
ะกะธััะตะผะฐ ะพัะบัััะฐ ะดะปั ัะฐััะธัะตะฝะธั (ะฝะฐัะปะตะดะพะฒะฐะฝะธะต Generator), ะทะฐะบัััะฐ ะดะปั ะผะพะดะธัะธะบะฐัะธะธ

### Liskov Substitution Principle โ
ะะพะถะฝะพ ะทะฐะผะตะฝะธัั Generator ะฝะฐ ะฝะฐัะปะตะดะฝะธะบะฐ ั ะบะฐััะพะผะฝะพะน ะปะพะณะธะบะพะน

### Interface Segregation Principle โ
ะะปะฐััั ะฝะต ะทะฐะฒะธััั ะพั ะธะฝัะตััะตะนัะพะฒ, ะบะพัะพััะต ะฝะต ะธัะฟะพะปัะทััั

### Dependency Inversion Principle โ
Controller ะทะฐะฒะธัะธั ะพั ะฐะฑัััะฐะบัะธะน (ScriptableObject), ะฝะต ะบะพะฝะบัะตัะฝัั ัะตะฐะปะธะทะฐัะธะน

## ๐งช ะขะตััะธััะตะผะพััั

### Unit-ัะตััะธััะตะผัะต ะบะพะผะฟะพะฝะตะฝัั:
- โ `ProceduralMapGenerator` - ัะธััะฐั ะปะพะณะธะบะฐ
- โ `MapAnalyzer` - ััะฐัะธัะตัะบะธะต ะผะตัะพะดั
- โ `MapGenerationConfig.GetRandomTileType()` - ะดะตัะตัะผะธะฝะธัะพะฒะฐะฝะฝะพ ั seed

### Integration-ัะตััะธััะตะผัะต:
- โ `MapBuilder` - ั mock ะฟัะตัะฐะฑะฐะผะธ
- โ `MapGeneratorController` - ะฒ ัะตััะพะฒะพะน ััะตะฝะต

## ๐ ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### Time Complexity
- **Grid Generation:** O(rยฒ) ะณะดะต r = radius
- **Tile Placement:** O(n) ะณะดะต n = tiles
- **Connectivity Check:** O(n)
- **Building:** O(n)
- **Total:** O(n) = O(rยฒ)

### Space Complexity
- **Generated Data:** O(n) - ัะปะพะฒะฐัั ะฟะพะทะธัะธะน
- **Physical Map:** O(n) - GameObjects ะฒ ััะตะฝะต
- **Temporary:** O(n) - ะดะปั BFS/pathfinding

### ะะฟัะธะผะธะทะฐัะธะธ
- โ ะะตะฝะตัะฐัะธั ะฒ editor-time (ะฝะต runtime)
- โ ะะดะธะฝะพะถะดั ัะพะทะดะฐะฝะฝัะต ะฟัะตัะฐะฑั
- โ ะะตะฝะธะฒะฐั ะธะฝะธัะธะฐะปะธะทะฐัะธั
- โ ะญััะตะบัะธะฒะฝัะต ััััะบัััั ะดะฐะฝะฝัั (Dictionary, HashSet)

## ๐ฎ ะะฐััะธััะตะผะพััั

### ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒะพะณะพ ัะธะฟะฐ ัะฐะนะปะฐ
```csharp
// 1. ะะพะฑะฐะฒะธัั ะฒ enum
public enum TileType { ..., NewType }

// 2. ะะพะฑะฐะฒะธัั ะฟัะพัะตะฝั ะฒ Config
public float NewTypePercentage = 5f;

// 3. ะะฑะฝะพะฒะธัั GetRandomTileType()
cumulative += NewTypePercentage;
if (roll < cumulative) return TileType.NewType;

// 4. ะะฐัะตะณะธัััะธัะพะฒะฐัั ะฟัะตัะฐะฑ ะฒ Controller
```

### ะะฐััะพะผะฝัะน ะณะตะฝะตัะฐัะพั
```csharp
public class BiomeMapGenerator : ProceduralMapGenerator
{
    protected override TileType DetermineTileType(Vector3Int pos, float dist)
    {
        // ะะฐัะฐ ะปะพะณะธะบะฐ ะฑะธะพะผะพะฒ
        int biome = CalculateBiome(pos);
        return GetTileForBiome(biome);
    }
}
```

### ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒะพะณะพ ะฟัะฐะฒะธะปะฐ
```csharp
// ะ MapGenerationConfig
public bool MyCustomRule = true;

// ะ ProceduralMapGenerator.GenerateMap()
if (_config.MyCustomRule)
{
    ApplyCustomRule();
}
```

## ๐ Best Practices

1. **ะัะตะณะดะฐ ะธัะฟะพะปัะทัะนัะต seed** ะดะปั ัะตััะธัะพะฒะฐะฝะธั
2. **ะะฝะฐะปะธะทะธััะนัะต ะบะฐััั** ะฟะตัะตะด ัะตะปะธะทะพะผ
3. **ะกะพััะฐะฝัะนัะต ัะดะฐัะฝัะต ะบะพะฝัะธะณะธ** ะบะฐะบ assets
4. **ะะฐะทะดะตะปัะนัะต ะณะตะฝะตัะฐัะธั ะธ ะฟะพัััะพะตะฝะธะต** ะดะปั ะณะธะฑะบะพััะธ
5. **ะัะฟะพะปัะทัะนัะต Editor tools** ะดะปั ะธัะตัะฐัะธะธ

## ๐ ะะฑััะฐััะธะต ัะตััััั

ะกะธััะตะผะฐ ัะตะฐะปะธะทัะตั ะบะพะฝัะตะฟัะธะธ:
- **Procedural Content Generation (PCG)**
- **Hexagonal Grid Systems (Cube Coordinates)**
- **Graph Algorithms (BFS)**
- **Weighted Random Selection**
- **ScriptableObject Architecture**

---

**ะะฒัะพั:** Unity Expert Procedural Generation Specialist  
**ะะตััะธั:** 1.0.0  
**ะะฐัะฐ:** 2025-10-06

